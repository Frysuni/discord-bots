В этом боте я решил реализовать систему модулей и билда.
Хостинг на cloudflare workers можно реализовать самому при помощи гугла. (интересная вещь)

Бот работает на mysql(mariadb) изначально. Перевести на mongoDB можно при необходимости https://typeorm.io/mongodb


**Запуск бота в продакшн:**
1. Настройте конфигурацию бота в `.env.prod` (читать комментарии из `.env`)
2. Введите команду `npm run build`
3. В каталоге `./build` будет лежать файл `build.tar.gz` (или используйте dist/)
4. Распакуйте файл на сервере, где будет стоять бот.
5. Введите команду `npm run start`. Это проверка бота на возможность функционирования и установка node_modules
6. Запустите бота с помощью **pm2** командой `npm run pm2`, если нет альтернативы.

**Запуск бота в дев-режиме:**
1. Настройте конфигурацию бота в `.env`
2. Введите команду `npm i`, а затем `npm run dev`

**Описание скриптов запуска в package.json:**
    `Команды, доступные только после билда и в структуре билда. (нет директории src):`
    "start"   - Запускает бота обычным способом.
    "pm2"     - Устанавливает pm2 и запускает бота с помощью него.
.
    `Команды, доступные из коренного каталога. (есть дирекория src):`
    "dev"     - Запускает бота из каталога src.
    "build"   - Собирает бота для релиза.
    "update"  - Полностью переустанавливает все зависимости. (не стоит трогать)

**Структура проекта**
NilBot
│
├── exampleModule            // Читать ниже в разделе про модули
│
├── services
│   ├── build.js             // Скрипт сборки проекта
│   └── updateDeps.js        // Скрипт, который полностью переустанавливает зависимости до последней версии
│
├── src                      // Исполняемый код
│   ├── handlers
│   │   ├── commands.ts      // Ищет команды в модулях, ставит на них листенеры ивентов и так же экспортирует в utils/deploySlash
│   │   ├── events.ts        // Ищет ивенты в модулях и ставит на них листенеры ивентов
│   │   ├── modules.ts       // Ищет index.ts в корне модуля и запускает его
│   │   ├── tableEntities.ts // Ищет структуры таблиц в модулях и экспортирует в system/database.ts
│   │   └── util_readDir.ts  // Утилита для хендлеров, упрощает читабильность кода.
│   │
│   ├── logger               // Система логгирования
│   │   ├── filesystem.ts    // Записывает логи в файл
│   │   └── index.ts         // Основной файл с типами логгирования
│   │
│   ├── modules              // Читать ниже в разделе про модули
│   │
│   ├── system
│   │   ├── bot.ts           // Запускает бота, экспортирует client
│   │   ├── database.ts      // Подключается к бд, экспортирует класс для удобного взаимодействия с таблицей бд
│   │   └── envConfig.ts     // Преобразует конфигурацию .env в удобный объект
│   │
│   └── utils
│       ├── crashHandler.ts  // * В случае просчета в коде прод не упадет.
│       │                    // * Это так то спорное решение, но после обсуждения с ребятами, решил, что лучше будет так, чем pm2 будет его перезапускать и тыкать.
│       └── deploySlash.ts   // Загружает слеш-команды на сервер дискорд, берет их из handlers/commands
│
├── .env                     // Env, который используется в npm run dev
├── .env.prod                // Env, который попадет в сборку проекта
├── .eslintrc.json           // Настройки линтера
├── .gitignore               // gitignore file
├── ecosystem.config.js      // Настройки pm2
├── LICENSE                  // License file
├── package.json             // node module dependencies
├── README.md                // This readme file
└── tsconfig.json            // TypeScript compiler options

**Добавления своего функционала. Модули:**
Модули являются основным рабочим компонентом бота, это экспериментальная структура.

Для начала нужно создать новую директорию модуля, допустим exampleModule. (Откройте эту папку для большего понимания)
В этой директории __при необходимости__ должны быть каталоги `database`, `commands`, `events` и файл `index.ts`

Все директории и файл index.ts `exampleModule/*` верхнего уровня являются опциональными

exampleModule
├── database        // Обязательно содержит файл `entity.ts`, так же (необязательно) `index.ts`
│   ├── entity.ts   // Содержит в себе классы таблиц. Посмотрите на содержание.
│   └── index.ts    // ORM структура работы с бд. Посмотрите на содержание.
├── commands        // Обязательно содержит хотя бы 1 файл команды. Команды добавлять в `exampleModule/events/` не нужно! Это делает handlers/commands
│   └── command.ts  // Содержит в себе экспорт объекта `data` и асинхронной функции `execute`. Названия файлов не имеют значения
├── events          // Кастомные ивенты для модулей.
│   └── event.ts    // Содержит в себе экспорт типа ивента `type` и асинхронной функции `execute`. Названия файлов не имеют значения
└── index.ts        // * Возможно, содержит в себе асинхронную функцию `execute`, если это требуется.
                    // * Будтье аккуратны, ведь взаимодействие с index, где будет код на верхем уровне может неожиданно его выполнить до инициализации бота.
                    // * Это приведет к непониманию происходящего, чего допускать нельзя! Но, index, иногда не содержит код, который должен выполниться
                    // * после полной инициализации бота, `execute` можно и опустить.
Все остальные каталоги не читаются и полностью под вашей властью!

Но вот модули описывать не хочу, правда. Код так то простой, без "странных" ветвлений, можно разобраться вообщем.

